{% extends "base.html" %}

{% block title %}Details for {{ item_id }} - {{ site_name }}{% endblock %}

{% block content %}
    {# Use item_id directly, details.label for the label #}
    <h2 class="text-3xl font-semibold text-dtu-red mb-1">Details for <code class="text-2xl bg-gray-100 px-2 py-1 rounded">{{ item_id }}</code></h2>
    {% if details.label and details.label != item_id %} {# Show label only if it's different from ID #}
        <p class="text-xl text-gray-600 mb-4">({{ details.label }})</p>
    {% endif %}

    {# Back Links #}
    <div class="mb-6 text-sm">
        <a href="{{ url_for('index') }}" class="text-dtu-red hover:underline">&laquo; Back to Home</a>
        {# Link back to the primary category list if available #}
        {% if details.primary_type_category_key %}
             <a href="{{ url_for('list_items', category_key=details.primary_type_category_key) }}" class="ml-4 text-dtu-red hover:underline">&laquo; Back to {{ details.primary_type_display }} List</a>
        {% endif %}
        {# General back button using browser history #}
        <button onclick="window.history.back();" class="ml-4 text-dtu-red hover:underline">Back</button>
    </div>

    {# --- Main Details Card --- #}
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8">
        <h3 class="text-xl font-semibold text-dtu-red border-b border-gray-200 pb-2 mb-4">Properties</h3>
        {% if details.properties %}
            {# Using a definition list for semantics #}
            <dl class="divide-y divide-gray-100">
                {# details.properties is now {'Predicate Display Name': [{'value': 'raw_val', 'display': 'display_val', 'is_link': True/False, 'list_link_info': {...}}, ...]} #}
                {% for pred_display, values in details.properties.items() | sort %} {# Sort by predicate display name #}
                    <div class="px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0">
                        <dt class="text-sm font-medium leading-6 text-gray-900">{{ pred_display }}</dt>
                        <dd class="mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0">
                            <ul class="list-none space-y-1">
                            {% for value_info in values %} {# Values are already sorted by display name in app.py #}
                                <li>
                                    {% if value_info.is_link %}
                                        {# Link to the detail page of the related item #}
                                        <a href="{{ url_for('details', item_id=value_info.value | urlencode ) }}" class="text-dtu-red hover:underline" title="View details for {{ value_info.value }}">
                                            {{ value_info.display }} {# Show label or ID #}
                                        </a>
                                        {# Add link to list related items view #}
                                        {% if value_info.list_link_info %}
                                            <a href="{{ url_for('list_items', predicate=value_info.list_link_info.predicate_key, object_value=value_info.list_link_info.object_value_encoded) }}"
                                               class="ml-2 text-xs text-gray-500 hover:text-dtu-red hover:underline"
                                               title="List all items where {{ value_info.list_link_info.predicate_display }} is {{ value_info.display }}">
                                                (List related)
                                            </a>
                                        {% endif %}
                                    {% else %}
                                        {# Display as plain text, use code tag for potential IDs/literals #}
                                        <code>{{ value_info.display }}</code>
                                    {% endif %}
                                </li>
                            {% endfor %}
                            </ul>
                        </dd>
                    </div>
                {% endfor %}
            </dl>
        {% else %}
            <p class="text-gray-500 italic">No properties found for this item.</p>
        {% endif %}
    </div>

    {# --- Referencing Items Card (Incoming Links) --- #}
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8">
        <h3 class="text-xl font-semibold text-dtu-red border-b border-gray-200 pb-2 mb-4">Referenced By</h3>
        {% if details.referencing_items %}
            <dl class="divide-y divide-gray-100">
                 {# details.referencing_items is [{'ref_id': '...', 'predicate_display': '...', 'ref_label': '...'}] #}
                {% for ref_info in details.referencing_items | sort(attribute='predicate_display') %} {# Sort by predicate #}
                     <div class="px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0">
                        {# Show the item that references the current one #}
                        <dt class="text-sm font-medium leading-6 text-gray-900">
                             <a href="{{ url_for('details', item_id=ref_info.ref_id | urlencode) }}" class="text-dtu-red hover:underline" title="View details for {{ ref_info.ref_id }}">
                                {{ ref_info.ref_label }}
                             </a>
                        </dt>
                        {# Show how it references the current item #}
                        <dd class="mt-1 text-sm leading-6 text-gray-700 sm:col-span-2 sm:mt-0">
                            (via predicate: <code>{{ ref_info.predicate_display }}</code>)
                        </dd>
                    </div>
                {% endfor %}
            </dl>
        {% else %}
            <p class="text-gray-500 italic">This item is not referenced by any other items via known predicates.</p>
        {% endif %}
    </div>

{% endblock %}

{# No specific scripts needed for details page currently #}
{% block scripts %}{% endblock %} 