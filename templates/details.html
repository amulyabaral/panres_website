{% extends "base.html" %}

{% block title %}Details for {{ item_id }} - {{ site_name }}{% endblock %}

{# Citation is now handled in base.html #}
{% block header_content %}
    {% if citation_text %}
    <div class="p-4 bg-gray-100 my-6 rounded-md shadow-lg">
        <div class="bg-white rounded-md p-4 space-y-2">
             <h3 class="text-xl font-medium text-dtu-red">Citation</h3>
             <p class="text-sm text-gray-700">{{ citation_text|safe }}</p>
        </div>
    </div>
    {% endif %}
{% endblock %}


{% block content %}

{# --- Main Details Container --- #}
<div class="bg-white rounded-md shadow-lg p-6 mb-8">

    {# Item ID Highlight #}
    <h2 class="text-2xl font-mono font-bold text-dtu-red mb-1 text-center break-all">{{ item_id }}</h2>

    {# Display primary type #}
    {% if details.primary_type_display %}
        <p class="text-center text-gray-600 text-sm mb-6">
            Type:
            {% if details.primary_type_category_key %}
                <a href="{{ url_for('list_items', category_key=details.primary_type_category_key) }}" class="text-dtu-red hover:underline">
                    {{ details.primary_type_display }}
                </a>
            {% else %}
                {{ details.primary_type_display }}
            {% endif %}
        </p>
    {% endif %}

    {# --- Property Grid --- #}
    {# Use Tailwind grid for layout #}
    <div class="grid grid-cols-1 {{ 'md:grid-cols-3' if is_pangen else 'md:grid-cols-2' }} gap-x-8 gap-y-6">

        {# --- Left/Main Column (or Key Info for PanGene) --- #}
        <div class="{{ 'md:col-span-2' if is_pangen else '' }}">
            <h3 class="text-lg font-medium text-dtu-red mb-3 pb-2 border-b border-gray-200">
                {{ "Key Information" if is_pangen else "Properties" }}
            </h3>
            <dl class="space-y-3 text-sm">
                {# Display Label if present and different from ID #}
                {% if details.label and details.label != item_id %}
                    <div>
                        <dt class="font-semibold text-gray-700 uppercase text-xs tracking-wide">Label</dt>
                        <dd class="text-gray-800 mt-0.5">{{ details.label }}</dd>
                    </div>
                {% endif %}

                {# Display Description if present #}
                {% if details.description %}
                     <div>
                        <dt class="font-semibold text-gray-700 uppercase text-xs tracking-wide">Description</dt>
                        <dd class="text-gray-600 mt-0.5">{{ details.description|safe }}</dd> {# Assume description might contain simple HTML #}
                    </div>
                {% endif %}

                {# Display other properties #}
                {% for prop in details.properties %}
                     {# Filter properties based on layout type #}
                     {% set show_prop = not is_pangen or (is_pangen and prop.predicate in pangen_key_info_preds) %}
                     {% if show_prop and prop.predicate != RDFS_LABEL and prop.predicate != RDFS_COMMENT and prop.predicate not in DESCRIPTION_PREDICATES %}
                        <div>
                            <dt class="font-semibold text-gray-700 uppercase text-xs tracking-wide">{{ predicate_map.get(prop.predicate, prop.predicate) }}</dt>
                            <dd class="text-gray-800 mt-0.5">
                                {% if prop.is_literal %}
                                    {# Check for specific literal types if needed, e.g., format numbers #}
                                    {{ prop.value }}
                                {% elif prop.is_external_uri %}
                                    <a href="{{ prop.value }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-dtu-red hover:underline">
                                        {{ prop.value }}
                                        <svg class="ml-1 w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                    </a>
                                {% elif prop.predicate in LINK_TO_RELATED_PREDICATES %}
                                     {# Link to related items page #}
                                     <a href="{{ url_for('show_related_items', predicate=prop.predicate, object_value=prop.value) }}" class="text-dtu-red hover:underline" title="Show items related via '{{ predicate_map.get(prop.predicate, prop.predicate) }}'">
                                         <code>{{ prop.value }}</code>
                                     </a>
                                {% else %}
                                    {# Link to details page for internal items #}
                                    <a href="{{ url_for('details', item_id=prop.value) }}" class="text-dtu-red hover:underline">
                                        <code>{{ prop.value }}</code>
                                    </a>
                                {% endif %}
                            </dd>
                        </div>
                    {% endif %}
                {% endfor %}
            </dl>
        </div>

        {# --- Right Column (Only for PanGene) --- #}
        {% if is_pangen %}
        <div>
            <h3 class="text-lg font-medium text-dtu-red mb-3 pb-2 border-b border-gray-200">Resistance & Links</h3>
             <dl class="space-y-3 text-sm">
                 {% for prop in details.properties %}
                     {% if prop.predicate in pangen_right_col_preds %}
                         <div>
                            <dt class="font-semibold text-gray-700 uppercase text-xs tracking-wide">{{ predicate_map.get(prop.predicate, prop.predicate) }}</dt>
                            <dd class="text-gray-800 mt-0.5">
                                {% if prop.is_literal %}
                                    {{ prop.value }}
                                {% elif prop.is_external_uri %}
                                     <a href="{{ prop.value }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-dtu-red hover:underline">
                                        {{ prop.value }}
                                        <svg class="ml-1 w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                    </a>
                                {% elif prop.predicate in LINK_TO_RELATED_PREDICATES %}
                                     <a href="{{ url_for('show_related_items', predicate=prop.predicate, object_value=prop.value) }}" class="text-dtu-red hover:underline" title="Show items related via '{{ predicate_map.get(prop.predicate, prop.predicate) }}'">
                                         <code>{{ prop.value }}</code>
                                     </a>
                                {% else %}
                                    <a href="{{ url_for('details', item_id=prop.value) }}" class="text-dtu-red hover:underline">
                                        <code>{{ prop.value }}</code>
                                    </a>
                                {% endif %}
                            </dd>
                        </div>
                    {% endif %}
                {% endfor %}
            </dl>
        </div>
        {% endif %}

        {# --- Referenced By Column --- #}
        <div>
             <h3 class="text-lg font-medium text-dtu-red mb-3 pb-2 border-b border-gray-200">Referenced By</h3>
             {% if details.referencing_items %}
                <dl class="space-y-2 text-sm">
                    {% for ref_item in details.referencing_items %}
                        {# Group references by predicate? Or just list them? Listing for now. #}
                         <div class="flex items-start">
                             <span class="text-gray-500 w-1/3 shrink-0 pr-2 text-right text-xs uppercase tracking-wide">{{ predicate_map.get(ref_item.predicate, ref_item.predicate) }}:</span>
                             <a href="{{ url_for('details', item_id=ref_item.ref_id) }}" class="text-dtu-red hover:underline"><code>{{ ref_item.ref_id }}</code></a>
                         </div>
                    {% endfor %}
                </dl>
            {% else %}
                <p class="text-sm text-gray-500 italic">This item is not referenced by any other items.</p>
            {% endif %}
        </div>

    </div> {# End Property Grid #}

</div> {# End Main Details Container #}


{# Back Links Footer #}
<div class="text-center space-x-4">
    <a href="{{ url_for('index') }}" class="text-sm text-dtu-red hover:underline">&laquo; Back to Home</a>
    {# Link back to the primary category list if available #}
    {% if details.primary_type_category_key %}
         <a href="{{ url_for('list_items', category_key=details.primary_type_category_key) }}" class="text-sm text-dtu-red hover:underline">&laquo; Back to {{ details.primary_type_display }} list</a>
    {% endif %}
    {# Add other relevant back links if needed #}
</div>

{% endblock %} 