{% extends "base.html" %}

{% block title %}Details for {{ item_id }} - PanRes Database Explorer{% endblock %}

{% block content %}
    <h2>Details for <code>{{ item_id }}</code></h2>

    <div class="details-section">
        <h3>Key Information</h3>
        {# Display the primary category/type if found #}
        {% if details.primary_type_display %}
            <p><strong>Category:</strong>
                <a href="{{ url_for('list_items', category_key=details.primary_type_category_key) }}">{{ details.primary_type_display }}</a>
            </p>
        {% endif %}
        {# List all rdf:types found, excluding owl:NamedIndividual if others exist #}
        {% if details.types %}
            <p><strong>RDF Type(s):</strong>
                {% set displayed_types = [] %}
                {% for type in details.types %}
                    {# Only show owl:NamedIndividual if it's the *only* type #}
                    {% if type != 'owl:NamedIndividual' or details.types|length == 1 %}
                        {% set _ = displayed_types.append("<code>" ~ type ~ "</code>") %}
                    {% endif %}
                {% endfor %}
                {{ displayed_types|join(', ')|safe }}
            </p>
        {% endif %}

        {% if details.label %}
            <p><strong>Label:</strong> {{ details.label }}</p>
        {% endif %}

         {% if details.comment %}
            <p><strong>Description:</strong> {{ details.comment }}</p>
        {% endif %}
    </div>


    <div class="details-section">
        {# Use predicate_map to get display names #}
        <h3>Properties / Relationships (Outgoing)</h3>
        {% if details.other_properties %}
            <table class="details-table">
                <thead>
                    <tr>
                        <th>Relationship / Property</th>
                        <th>Value / Target Item</th>
                        {# Removed Type column #}
                    </tr>
                </thead>
                <tbody>
                {% for prop in details.other_properties %}
                    <tr>
                        {# Use display name from map, fallback to original predicate #}
                        <td>{{ predicate_map.get(prop.predicate, prop.predicate) }}</td>
                        <td>
                            {% if prop.object_is_literal %}
                                {{ prop.object }}
                                {% if prop.object_datatype %}<span class="datatype"> ({{ predicate_map.get(prop.object_datatype, prop.object_datatype) }})</span>{% endif %}
                            {% else %}
                                {# Link to details page for resources #}
                                <a href="{{ url_for('details', item_id=prop.object) }}"><code>{{ prop.object }}</code></a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No other outgoing properties or relationships found (besides type, label, comment if shown above).</p>
        {% endif %}
    </div>

    <div class="details-section">
        <h3>Referenced By (Incoming Relationships)</h3>
         {% if references %}
            <table class="details-table">
                 <thead>
                    <tr>
                        <th>Source Item</th>
                        <th>Relationship</th>
                         {# Removed Type column #}
                    </tr>
                </thead>
                <tbody>
                {% for ref in references %}
                    <tr>
                        <td><a href="{{ url_for('details', item_id=ref.subject) }}"><code>{{ ref.subject }}</code></a></td>
                        {# Use display name from map, fallback to original predicate #}
                        <td>{{ predicate_map.get(ref.predicate, ref.predicate) }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>This item is not the target of any known relationships from other items.</p>
        {% endif %}
    </div>


    <p class="back-link"><a href="{{ url_for('index') }}">&laquo; Back to Home</a></p>
    {# Link back to the primary category list if available #}
    {% if details.primary_type_category_key %}
         <p class="back-link"><a href="{{ url_for('list_items', category_key=details.primary_type_category_key) }}">&laquo; Back to {{ details.primary_type_display }} list</a></p>
    {% endif %}
    {# Consider adding a back link using request.referrer if needed #}

{% endblock %} 